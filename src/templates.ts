export function renderUserMd(params: { name?: string; timezone?: string | null }) {
  return `# USER\n\nName: ${params.name ?? "(unknown)"}\nTimezone: ${params.timezone ?? "(unknown)"}\n\n## Preferences\n- Draft external comms\n- PRs only\n`;
}

export function renderGoalsMd(params?: { goals?: string[] }) {
  const goals = params?.goals?.length ? params.goals : ["(add your goals here)"];
  return `# GOALS\n\n${goals.map((g) => `- ${g}`).join("\n")}\n`;
}

export function renderMemoryMd(params?: { seed?: string | null }) {
  return `# MEMORY\n\n${params?.seed ? params.seed : "(autogenerated seed)"}\n`;
}

export function slugify(input: string) {
  return (input || "")
    .toLowerCase()
    .replace(/[^a-z0-9]+/g, "-")
    .replace(/(^-|-$)/g, "")
    .slice(0, 64) || "project";
}

export function renderProjectMd(p: any) {
  return `# PROJECT\n\nName: ${p.name || "(unnamed)"}\nStatus: ${p.status || "active"}\n\n## Goal\n${p.goal_title || ""}\n\n${p.goal_description || ""}\n`;
}

export function renderTasksMd(params: { tasks: any[] }) {
  const tasks = params.tasks || [];
  const byStatus = (s: string) => tasks.filter((t) => t.status === s);

  const section = (title: string, items: any[]) => {
    if (!items.length) return `## ${title}\n\n- (none)\n`;
    return `## ${title}\n\n${items
      .map((t) => `- [ ] ${t.title || "(untitled)"}  (id:${t.id})`)
      .join("\n")}\n`;
  };

  return [
    "# TASKS\n",
    section("Blocked", byStatus("blocked")),
    section("Needs Review", byStatus("review")),
    section("In Progress", byStatus("in_progress")),
    section("Queued", byStatus("queued")),
    section("Backlog", byStatus("pending")),
  ].join("\n");
}

export function renderJobsMd(params: { jobs: any[] }) {
  const jobs = params.jobs || [];
  return `# JOBS\n\n${jobs.length ? jobs.map((j) => `- ${j.cron_expression} (${j.timezone}) ${j.enabled ? "ON" : "OFF"}`).join("\n") : "- (none)"}\n`;
}
